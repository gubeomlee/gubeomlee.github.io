---
layout: default
title: CPU의 작동원리
parent: CS 스터디 컴퓨터 구조, 운영체제
nav_order: 4
---

# 데이터

---

## ALU와 제어장치

#### ALU

- ALU는 레지스터에서 피연산자를 받고, 제어장치에서 제어신호를 받는다.
- ALU는 산술연산, 논리연산 등 다양한 연산을 수행한다.
- 메모리 접근이 속도는 레지스터 접근 속도보다 느려, ALU는 연산을 수행한 결과는 바로 메모리에 저장되는 것이 아니라 일시적으로 레지스터에 저장된다.

#### 플래그

- ALU는 계산 결과와 함께 추가적인 상태 정보인 플래그를 내보낸다. 플래그는 플래그 레지스트에 저장된다.
- 부호 플래그: 연산 결과의 부호를 나타낸다. 1인 경우 음수, 0인 경우 양수다.
- 제로 플래그: 연산 결과가 0인지 나타낸다. 1인 경우 연산결과가 0이고, 0인 경우 연산결과가 0이 아니다.
- 캐리 플래그: 올림수, 빌림수가 발생했는지 나타낸다. 1인 경우 발생했고, 0인 경우 발생하지 않았다.
- 오버플로우 플래그: 오버플로우(연산 결과가 레지스트보다 큰 경우)가 발생했는지 나타낸다. 1인 경우 발생했고, 0인 경우 발생하지 않았다.
- 인터럽트 플래그: 인터럽트 가능여부를 나타낸다. 1인 경우 가능하고, 0인 경우 불가능하다.
- 슈퍼바이저 플래그: 커널모드, 사용자모드를 나타낸다. 1인 경우 커널모드고, 0인 경우 사용자모드다.

#### 제어장치

- 제어장치는 제어신호를 보낸다.
- 클럭 신호: 컴퓨터의 모든 부품은 클럭 박자에 맞춰 작동한다.
- 해석해야 할 명령어: 명령어 레지스터에서 해석할 명령어를 받는다. 명령어를 해석한 뒤 제어신호를 발생시켜 컴퓨터 부품이 수행해야할 내용을 알려준다.
- 플래그 값: 플래그 값을 참고하여 제어신호를 내보낸다.
- 제어버스 제어신호: 외부에서 발생한 제어신호를 받는다.
- 제어장치는 CPU 내부/외부에 제어신호를 전달한다.
- 제어장치가 내부에 전달하는 제어신호는 연산 지시를 위해 ALU에 전달하는 제어신호와 데이터 이동 및 저장 명령어 해석을 위해 레지스터에 저달하는 제어신호가 있다.
- 제어장치가 외부에 전달하느 제어신호는 입출력 장치 및 메모리의 값을 읽거나 쓰기 위해서 전달된다.

## 레지스터

#### 반드시 알아야 하는 레지스터

- 프로그램 카운터: 메모리에서 읽어 들일 명령어의 주소를 저장한다. 명령어 포인터라고 부르기도 한다.
- 명령어 레지스터: 방금 읽어 들인 명려어로 해석할 명령어를 저장한다. 제어 장치는 명령어 해석 후 제어 신호를 내보낸다.
- 메모리 주소 레지스터: 읽어 들일 메모리 주소를 저장한다. CPU가 읽어 들이고자 하는 주소 값을 주소 버스로 보낼 때 메모리 주소 레지스터를 거친다.
- 메모리 버퍼 레지스터: 메모리와 주고 받은 값을 저장한다. 데이터 버스로 주고 받을 값은 메모리 버퍼 레지스터를 거친다.
- 플래그 레지스터: CPU상태에 대한 부가적인 정보를 저장하는 레지스터다.
- 범용 레지스터: 일반적인 상황에서 자유롭게 사용할 수 있는 레지스터다.
- 스택 포인터: 스택 주소 지정 방식에 사용된다.
- 베이스 레지스터: 베이스 레지스터 주소 지정 방식에 사용된다.

#### 스택 주소 지정 방식

- 스택과 스택 포인터를 이용한 주소 지정 방식이다.
- 스택 포인터는 스택 꼭대기를 가리키는 레지스터다.

#### 변위 주소 지정 방식

- 오퍼랜드 필드값과 특정 레지스터의 값을 더하여 유효 주소를 얻는 방식이다.
- 상대 주소 지정 방식: 오퍼랜드와 프로그램 카운터의 값을 더해 유효 주소를 얻는다. 프로그램 카운터에 담긴 주소가 기준이고, 오퍼랜드는 기준으로부터 거리다.
- 베이스 레지스터 주소 지정 방식: 오퍼랜드와 베이스 레지스터 값을 더해 유효 주소를 얻는다. 베이스 레지스터에 담긴 주소가 기준이고, 오퍼랜드는 기준으로부터 거리다.

## 명령어 사이클과 인터럽스

- 명령어 사이클: 명령어를 처리하는 정형화된 흐름.
- 인터럽스: 명령어 처리과정 이 흐름이 끊어지는 상황.

#### 명령어 사이클

- 명령어 사이클: 프로그램 속 명령어들이 일정한 주기에 따라 실행된다.
- 인출 사이클: 메모리에 있는 명령어를 CPU로 가져오는 단계다.
- 실행 사이클: CPU에서 가져온 명령어를 실행하는 단계다. 제어장치가 명령어 레지스터에 담긴 값을 해석하고 제어 신호를 발생시킨다.
- 간접 사이클: 간접 주소 지정 방식에서 메모리에 접근하는 단계다.

#### 인터립트

- CPU의 작업을 방해하는 신호다.
- 동기 인터럽트(예외): CPU에 의해 발생한다. CPU가 실행하는 프로그래밍상의 오류와 같은 예외적인 상황에서 발생한다. '예외'라고 부르기도 한다.
- 비동기 인터럽트(하드웨어 인터럽트): 입출력장치에 의해 발생한다. 입출력 작업 중에도 CPU가 효율적으로 명령어를 처리할 수 있다.

#### 하드웨어 인터럽트 순서

- 입출력장치는 CPU에 인터럽트 요청 신호를 보낸다.
- CPU는 실행 사이클이 끝나고 명령어를 인출하기 전 항상 인터럽트 여부를 확인한다.
- CPU는 인터럽트 요청을 확인하고 인터럽트 플래그를 통해 인터럽트 받을 수 있는지 확인한다. 인터럽트 요청을 수용하기 위해서는 인터럽트 플래그가 활성화되어 있어야 한다. 인터럽트 플래그 비활성임에도 불구하고 정전, 하드웨어 고장으로 인한 인터럽트는 무시할 수 없다.
- 인터럽트를 받을 수 있다면 CPU는 지금까지 작업을 백업한다.
- 인터럽트 백터를 참조하여 인터럽트 서비스 루틴을 실행한다. 인터럽트 백터는 인터럽트 서비스 루틴을 식별하기 위한 정보다.
- 인터럽트 서비스 루틴이 끝나면 백업해둔 작업을 복구하여 실행한다.

#### 예외의 종류

- 예외가 발생하면 CPU는 하던 일을 중단하고 예외를 처리한다. 예외를 처리하고 본래 작업으로 돌아오는 시점에 따라 폴트와 트랩으로 구분한다.
- 폴트: 예외가 발생한 명령어부터 실행을 재개한다.
- 트랩: 예외가 발생한 다음 명령어부터 실행을 재개한다.
