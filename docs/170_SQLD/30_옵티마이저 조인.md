---
layout: default
title: 옵티마이저 조인
parent: SQLD
nav_order: 30
---

# 옵티마이저 조인

---

## 옵티마이저 조인 방식

- Nested Loop Join: 선행 테이블에서 데이터를 찾고 후행 테이블을 조인
- Sort Merge Join: 조인 컬럼을 기준으로 데이터를 정렬하여 조인
- Hash Join: 해시 함수를 이용해서 데이터를 조인

## Nested Loop Join(NL Join)

#### 개념

- 선행 테이블에서 데이터를 찾고 후행 테이블에 조인하는 방식으로 실행된다.
- 선행 테이블의 크기가 작아야 데이터가 스캔되는 범위를 줄일 수 있다.
- Random Access가 밸생한다.
- Random Access가 많이 발생하면 성능 지연이 발생하기 때문에 Random Access 양을 줄여야 한다.
- Random Access는 대량의 데이터를 조인할 때 비효율적이다.

#### 실행방식

- 선행 테이블에서 조건을 만족하는 첫 행을 찾는다.
- 후행 테이블에서 인덱스에 선행 테이블의 조인 키가 있는지 확인한다.
- 인덱스에서 추출한 레코드 식별자를 이용하여 후행 테이블을 접근한다.
- 후행 테이블에 주어진 조건까지 만족하면 해당 행을 추출하여 버퍼에 넣는다.

## Sort Merge Join(SM Join)

#### 개념

- 조인 컬럼을 기준으로 데이터를 정렬하여 조인한다.
- 동등, 비동등 조건에서 모두 사용할 수 있다.
- 인덱스가 없는 경우에도 사용할 수 있다.
- 항상 정렬 작업이 발생하는 것은 아니다.
- 정렬 데이터양이 많으면 정렬은 디스크에 있는 임시 영역에서 수행되기 때문에 성능이 급격히 떨어진다.

#### 실행방식

- 선행 테이블에서 조건을 만족하는 첫 행을 찾는다.
- 조인 키를 기준으로 조건을 만족하는 첫 행을 찾는다.
- 후행 테이블에서 조건을 만족하는 첫 행을 찾는다.
- 조인 키를 기준으로 정렬 작업을 수행한다.
- 정렬된 결과를 이용하여 조인을 수행한다.
- 조인에 성공하면 추출 버퍼에 넣는다.

## Hash Join

#### 개념

- 해시함수를 이용해서 조인 컬럼의 동일한 해시값을 갖는 데이터를 조인한다.
- 두 테이블을 스캔하여 크기가 작은 테이블을 선행 테이블로 잡는다.
- 동등 조건에서만 사용 가능하다.
- 삽입, 삭제, 탐색이 매우 빠르다.
- Sort Merge Join 하기에 두 테이블이 너무 커서 SORT 부하가 심할 때 유용하다.
- Hash Join은 조인 작업을 수행하기 위해 해시 테이블을 메모리에 새성해야 한다.
- 해시 테이블을 메모리에 새성헤야 하기 때문에 결과 행의 수가 적은 선행 테이블을 사용하는 것이 좋다.

#### 실행방식

- 선행 테이블에서 조건을 만족하는 첫 행을 찾는다.
- 선행 테이블의 조인 키를 기준으로 해시 함수를 적용하여 해시 테이블을 생성한다.
- 후행 테이블에서 조건을 만족하는 첫 행을 찾는다.
- 후행 테이블의 조인 키를 기준으로 해시 함수를 적용하여 해시 테이블을 생성한다.
- 해시 함수에서 리턴받은 버킷 주소로 찾아가서 해시 체인을 스캔하면서 데이터를 찾는다.

## 비교

|                   Nested Loop Join                   |             Sort Merge Join             |                                 Hash Join                                  |
| :--------------------------------------------------: | :-------------------------------------: | :------------------------------------------------------------------------: |
|               EQUI Join, Non-EQUI Join               |        EQUI Join, Non-EQUI Join         |                                 EQUI Join                                  |
|                                                      |      대용량 테이블을 조인하는 경우      |                       대용량 테이블을 조인하는 경우                        |
|       크기가 작은 테이블을 선행 테이블로 사용        |                                         |                  크기가 작은 테이블을 선행 테이블로 사용                   |
| 인덱스가 있어서 NATURAL JOIN이 효율적일 때 유용하다. |   인덱스의 유무에 영향을 받지 않는다.   |                          인덱스가 필수가 아니다.                           |
|                                                      | 해시 함수를 이용해서 데이터를 조인한다. | Sort Merge Join 하기에 두 테이블이 너무 커서 SORT 부하가 심할 때 유용하다. |
|           OLTP 목록 처리 업무에 사용한다.            |  DW 등의 데이터 집계 업무에 사용한다.   |                    DW 등의 데이터 집계 업무에 사용한다.                    |
